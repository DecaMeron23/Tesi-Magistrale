/*
 * srv_pwm_reader.c
 *
 *  Created on: 13 gen 2026
 *      Author: emilio
 */

#include "srv_pwm_reader.h"
#include "custom_stm.h"
#include "stdlib.h"
#include "app_conf.h"

uint32_t getPWM();

void SRV_APP_PwmReader(uint8_t *UpdateCharData)
{
	uint32_t freq = getPWM();
	UpdateCharData[0] = freq & 0xFF000000;
	UpdateCharData[1] = freq & 0x00FF0000;
	UpdateCharData[2] = freq & 0x0000FF00;
	UpdateCharData[3] = freq & 0x000000FF;
	Custom_STM_App_Update_Char(CUSTOM_STM_VARIABLE_CHAR, (uint8_t*) UpdateCharData);

}

void SRV_APP_StartPwmNotify()
{
	UTIL_SEQ_ResumeTask(1 << CFG_TASK_NOTIFY_PWM_ID);
	UTIL_SEQ_SetTask(1 << CFG_TASK_NOTIFY_PWM_ID , CFG_SCH_PRIO_0);

}
void SRV_APP_StopPwmNotify()
{
	// TODO
}

uint32_t getPWM()
{
	return rand() % 10000 + 1000;
}
